<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0a0712" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <title>AD ICONIQ â€” Official Store</title>

  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="stylesheet" href="./styles.css?v=7">

  <!-- Optional: nicer font without screaming â€œtemplateâ€ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>

<body class="bg">
  <!-- Neon ambient layers -->
  <div class="ambient" aria-hidden="true">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
    <div class="grain"></div>
    <div class="vignette"></div>
  </div>

  <!-- Top bar -->
  <header class="topbar glass">
    <div class="brand">
      <div class="logo-orb" aria-hidden="true">
        <span class="logo-txt">AD</span>
      </div>
      <div class="brand-copy">
        <div class="brand-name">AD ICONIQ</div>
        <div class="brand-sub">Official Store</div>
      </div>
    </div>

    <div class="topbar-actions">
      <label class="search glass-soft" aria-label="Search">
        <span class="icon">âŒ•</span>
        <input id="search-input" type="search" placeholder="Search the catalogâ€¦" autocomplete="off" />
      </label>

      <a class="pill glass-soft" href="./catalog.html" aria-label="Shop">
        Shop
      </a>

      <a class="pill glass-soft" href="./cart.html" aria-label="Cart">
        Cart <span id="cart-count" class="badge hidden">0</span>
      </a>
    </div>
  </header>

  <main class="wrap">
    <!-- Hero -->
    <section class="hero">
      <div class="hero-card glass">
        <div class="hero-kicker">
          <span class="dot"></span>
          <span>Electric glass commerce. Built for AD ICONIQ.</span>
        </div>

        <h1 class="hero-title">
          Luxury, without noise.
          <span class="shine">Neon, without cheap.</span>
        </h1>

        <p class="hero-sub">
          Real products pulled live from your Shopify Storefront API. Fast, clean, and mobile-first.
        </p>

        <div class="hero-cta">
          <a class="btn primary" href="./catalog.html">Open Catalog</a>
          <a class="btn ghost" href="./cart.html">View Cart</a>
        </div>

        <div class="hero-metrics">
          <div class="metric glass-soft">
            <div class="metric-label">Storefront</div>
            <div class="metric-value" id="api-status">Checkingâ€¦</div>
          </div>
          <div class="metric glass-soft">
            <div class="metric-label">Products</div>
            <div class="metric-value" id="product-count">â€”</div>
          </div>
        </div>

        <div class="hero-outline" aria-hidden="true"></div>
      </div>
    </section>

    <!-- Featured -->
    <section class="section">
      <div class="section-head">
        <h2>Featured</h2>
        <a class="link" href="./catalog.html">View all</a>
      </div>

      <div id="featured-grid" class="grid">
        <!-- populated by JS -->
        <div class="skeleton glass-soft"></div>
        <div class="skeleton glass-soft"></div>
      </div>
    </section>

    <!-- Bottom nav -->
    <nav class="bottom-nav glass" aria-label="Bottom Navigation">
      <a class="nav-item active" href="./index.html">
        <span class="nav-ico">âŒ‚</span>
        <span>Home</span>
      </a>
      <a class="nav-item" href="./catalog.html">
        <span class="nav-ico">â˜…</span>
        <span>Catalog</span>
      </a>
      <a class="nav-item" href="./cart.html">
        <span class="nav-ico">ðŸ›’</span>
        <span>Cart</span>
      </a>
      <a class="nav-item" href="./account.html">
        <span class="nav-ico">ðŸ‘¤</span>
        <span>Account</span>
      </a>
    </nav>
  </main>

  <script>
    // ===== Shopify Storefront config (PUBLIC token only) =====
    const SHOPIFY_DOMAIN = "xfkvxx-iz.myshopify.com";
    const STOREFRONT_TOKEN = "639111507512d9723d5efdd3fd6a8152";
    const STOREFRONT_API_VERSION = "2026-01";

    const endpoint = `https://${SHOPIFY_DOMAIN}/api/${STOREFRONT_API_VERSION}/graphql.json`;

    // Service worker (keep it, but caching can be annoying while iterating)
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./sw.js").catch(() => {});
      });
    }

    // Cart badge from localStorage (works with your existing cart logic)
    function updateCartBadge() {
      try {
        const cart = JSON.parse(localStorage.getItem("adiconiq-cart") || "[]");
        const count = cart.reduce((t, i) => t + (i.quantity || 0), 0);
        const badges = document.querySelectorAll("#cart-count");
        badges.forEach(b => {
          if (count > 0) { b.textContent = String(count); b.classList.remove("hidden"); }
          else { b.classList.add("hidden"); }
        });
      } catch (_) {}
    }

    // Shopify fetch helper
    async function storefront(query, variables = {}) {
      const res = await fetch(endpoint, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-Shopify-Storefront-Access-Token": STOREFRONT_TOKEN
        },
        body: JSON.stringify({ query, variables })
      });
      const json = await res.json();
      if (!res.ok || json.errors) throw new Error((json.errors && json.errors[0] && json.errors[0].message) || "Storefront error");
      return json.data;
    }

    // Featured products (clean, real images)
    async function loadFeatured() {
      const grid = document.getElementById("featured-grid");
      const apiStatus = document.getElementById("api-status");
      const productCount = document.getElementById("product-count");

      const query = `
        query Featured($first:Int!){
          products(first:$first, sortKey:BEST_SELLING){
            edges{
              node{
                id
                title
                handle
                availableForSale
                featuredImage{ url altText }
                priceRange{
                  minVariantPrice{ amount currencyCode }
                }
              }
            }
          }
        }
      `;

      try {
        const data = await storefront(query, { first: 6 });
        const items = (data.products.edges || []).map(e => e.node);
        apiStatus.textContent = "Online";
        apiStatus.classList.add("ok");
        productCount.textContent = String(items.length);

        grid.innerHTML = items.map(p => {
          const img = p.featuredImage?.url || "";
          const alt = p.featuredImage?.altText || p.title || "Product";
          const amount = Number(p.priceRange?.minVariantPrice?.amount || 0);
          const currency = p.priceRange?.minVariantPrice?.currencyCode || "USD";
          const price = new Intl.NumberFormat(undefined, { style: "currency", currency }).format(amount);

          return `
            <a class="card glass-soft" href="./catalog.html?handle=${encodeURIComponent(p.handle)}">
              <div class="card-media">
                ${img ? `<img loading="lazy" src="${img}" alt="${alt}">` : `<div class="img-fallback"></div>`}
                <div class="bloom" aria-hidden="true"></div>
              </div>
              <div class="card-body">
                <div class="card-title">${escapeHtml(p.title || "")}</div>
                <div class="card-row">
                  <div class="card-price">${price}</div>
                  <div class="chip ${p.availableForSale ? "live" : "sold"}">${p.availableForSale ? "Live" : "Sold"}</div>
                </div>
              </div>
              <div class="card-outline" aria-hidden="true"></div>
            </a>
          `;
        }).join("");
      } catch (e) {
        apiStatus.textContent = "Offline";
        apiStatus.classList.remove("ok");
        productCount.textContent = "â€”";
        grid.innerHTML = `
          <div class="error glass-soft">
            <div class="error-title">Couldnâ€™t load products</div>
            <div class="error-sub">This is usually token/domain/version or caching. Weâ€™ll fix it.</div>
          </div>
        `;
      }
    }

    // Search just redirects to catalog with query
    function wireSearch() {
      const input = document.getElementById("search-input");
      if (!input) return;
      let t;
      input.addEventListener("input", () => {
        clearTimeout(t);
        t = setTimeout(() => {
          const q = input.value.trim();
          // no â€œlive filteringâ€ on home. Just keep it clean.
        }, 250);
      });
      input.addEventListener("keydown", (ev) => {
        if (ev.key === "Enter") {
          const q = input.value.trim();
          if (q) window.location.href = `./catalog.html?q=${encodeURIComponent(q)}`;
        }
      });
    }

    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, (m) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    // Kickoff
    updateCartBadge();
    wireSearch();
    loadFeatured();

    // Make caching less annoying while iterating:
    // if you keep seeing old builds, open:  .../index.html?v=9
  </script>
</body>
</html>