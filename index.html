<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#07040f" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>AD ICONIQ ‚Äî Official Store</title>

  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="stylesheet" href="./styles.css?v=1000">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>

<body class="bg">
  <!-- Ambient neon + grain -->
  <div class="ambient" aria-hidden="true">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
    <div class="grain"></div>
    <div class="vignette"></div>
  </div>

  <header class="topbar glass">
    <div class="brand">
      <div class="logo-orb" aria-hidden="true">
        <svg class="logo-svg" viewBox="0 0 64 64" role="img" aria-label="AD">
          <defs>
            <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#ff2bd1"/>
              <stop offset="0.55" stop-color="#7c3aed"/>
              <stop offset="1" stop-color="#00d4ff"/>
            </linearGradient>
          </defs>
          <path fill="url(#g1)" d="M20 46V18h10.2c7.7 0 13 5.3 13 14s-5.3 14-13 14H20zm7.2-6.3h3.1c4.2 0 6.7-2.8 6.7-7.7 0-5-2.5-7.7-6.7-7.7h-3.1v15.4z"/>
          <path fill="rgba(10,7,18,.88)" d="M44.5 46l-2.2-6.2H32.4L30.2 46h-6.6l9.8-28h8.3l9.8 28h-7zm-10.3-11.6h6.1l-3-9.2-3.1 9.2z"/>
        </svg>
        <span class="logo-spec" aria-hidden="true"></span>
      </div>

      <div class="brand-copy">
        <div class="brand-name">AD ICONIQ</div>
        <div class="brand-sub">Official Store</div>
      </div>
    </div>

    <div class="topbar-actions">
      <label class="search glass-soft" aria-label="Search">
        <span class="icon">‚åï</span>
        <input id="search-input" type="search" placeholder="Search‚Ä¶" autocomplete="off" />
      </label>

      <a class="pill glass-soft" href="./catalog.html" aria-label="Shop">Shop</a>

      <a class="pill glass-soft" href="./cart.html" aria-label="Cart">
        Cart <span id="cart-count" class="badge hidden">0</span>
      </a>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <div class="hero-card glass">
        <div class="hero-kicker">
          <span class="dot"></span>
          <span>Electric glass commerce built for AD ICONIQ.</span>
        </div>

        <h1 class="hero-title">
          Clean. Expensive.
          <span class="shine">Neon, controlled.</span>
        </h1>

        <p class="hero-sub">
          Live products pulled from Shopify Storefront API. Minimal UI. Real motion. No fake ‚Äúluxury‚Äù stickers.
        </p>

        <div class="hero-cta">
          <a class="btn primary" href="./catalog.html">Open Catalog</a>
          <a class="btn ghost" href="./cart.html">View Cart</a>
        </div>

        <div class="hero-metrics">
          <div class="metric glass-soft">
            <div class="metric-label">Storefront</div>
            <div class="metric-value" id="api-status">Checking‚Ä¶</div>
          </div>
          <div class="metric glass-soft">
            <div class="metric-label">Featured loaded</div>
            <div class="metric-value" id="product-count">‚Äî</div>
          </div>
        </div>

        <div class="hero-outline" aria-hidden="true"></div>
        <div class="hero-highlight" aria-hidden="true"></div>
      </div>
    </section>

    <section class="section">
      <div class="section-head">
        <h2>Featured</h2>
        <a class="link" href="./catalog.html">View all</a>
      </div>

      <div id="featured-grid" class="grid">
        <div class="skeleton glass-soft"></div>
        <div class="skeleton glass-soft"></div>
        <div class="skeleton glass-soft"></div>
        <div class="skeleton glass-soft"></div>
      </div>
    </section>

    <nav class="bottom-nav glass" aria-label="Bottom Navigation">
      <a class="nav-item active" href="./index.html"><span class="nav-ico">‚åÇ</span><span>Home</span></a>
      <a class="nav-item" href="./catalog.html"><span class="nav-ico">‚òÖ</span><span>Catalog</span></a>
      <a class="nav-item" href="./cart.html"><span class="nav-ico">üõí</span><span>Cart</span></a>
      <a class="nav-item" href="./account.html"><span class="nav-ico">üë§</span><span>Account</span></a>
    </nav>
  </main>

  <script>
    const SHOPIFY_DOMAIN = "xfkvxx-iz.myshopify.com";
    const STOREFRONT_TOKEN = "639111507512d9723d5efdd3fd6a8152";
    const STOREFRONT_API_VERSION = "2026-01";

    const endpoint = `https://${SHOPIFY_DOMAIN}/api/${STOREFRONT_API_VERSION}/graphql.json`;

    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./sw.js").catch(() => {});
      });
    }

    function updateCartBadge() {
      try {
        const cart = JSON.parse(localStorage.getItem("adiconiq-cart") || "[]");
        const count = cart.reduce((t, i) => t + (i.quantity || 0), 0);
        const b = document.getElementById("cart-count");
        if (!b) return;
        if (count > 0) { b.textContent = String(count); b.classList.remove("hidden"); }
        else { b.classList.add("hidden"); }
      } catch (_) {}
    }

    async function storefront(query, variables = {}) {
      const res = await fetch(endpoint, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-Shopify-Storefront-Access-Token": STOREFRONT_TOKEN
        },
        body: JSON.stringify({ query, variables })
      });
      const json = await res.json();
      if (!res.ok || json.errors) throw new Error((json.errors && json.errors[0] && json.errors[0].message) || "Storefront error");
      return json.data;
    }

    async function loadFeatured() {
      const grid = document.getElementById("featured-grid");
      const apiStatus = document.getElementById("api-status");
      const productCount = document.getElementById("product-count");

      const query = `
        query Featured($first:Int!){
          products(first:$first, sortKey:BEST_SELLING){
            edges{
              node{
                id title handle availableForSale
                featuredImage{ url altText }
                priceRange{ minVariantPrice{ amount currencyCode } }
              }
            }
          }
        }
      `;

      try {
        const data = await storefront(query, { first: 8 }); // more than 6
        const items = (data.products.edges || []).map(e => e.node);

        apiStatus.textContent = "Online";
        apiStatus.classList.add("ok");
        productCount.textContent = String(items.length);

        grid.innerHTML = items.map(p => {
          const img = p.featuredImage?.url || "";
          const alt = p.featuredImage?.altText || p.title || "Product";
          const amount = Number(p.priceRange?.minVariantPrice?.amount || 0);
          const currency = p.priceRange?.minVariantPrice?.currencyCode || "USD";
          const price = new Intl.NumberFormat(undefined, { style: "currency", currency }).format(amount);

          return `
            <a class="card glass-soft" href="./catalog.html?handle=${encodeURIComponent(p.handle)}">
              <div class="card-media">
                ${img ? `<img loading="lazy" src="${img}" alt="${escapeHtml(alt)}">` : `<div class="img-fallback"></div>`}
                <div class="bloom" aria-hidden="true"></div>
                <div class="spec" aria-hidden="true"></div>
              </div>
              <div class="card-body">
                <div class="card-title">${escapeHtml(p.title || "")}</div>
                <div class="card-row">
                  <div class="card-price">${price}</div>
                  <div class="chip ${p.availableForSale ? "live" : "sold"}">${p.availableForSale ? "Live" : "Sold"}</div>
                </div>
              </div>
              <div class="card-outline" aria-hidden="true"></div>
            </a>
          `;
        }).join("");
      } catch (e) {
        apiStatus.textContent = "Offline";
        apiStatus.classList.remove("ok");
        productCount.textContent = "‚Äî";
        grid.innerHTML = `
          <div class="error glass-soft">
            <div class="error-title">Couldn‚Äôt load products</div>
            <div class="error-sub">Token/domain/version/caching. The UI is fine, the data call failed.</div>
          </div>
        `;
      }
    }

    function wireSearch() {
      const input = document.getElementById("search-input");
      if (!input) return;
      input.addEventListener("keydown", (ev) => {
        if (ev.key === "Enter") {
          const q = input.value.trim();
          if (q) window.location.href = `./catalog.html?q=${encodeURIComponent(q)}`;
        }
      });
    }

    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, (m) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    updateCartBadge();
    wireSearch();
    loadFeatured();
  </script>
</body>
</html>